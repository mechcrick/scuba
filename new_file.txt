This is the modification I made from second push effort from mac